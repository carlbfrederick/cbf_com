---
title: Using R to Create Google Maps
author: ~
date: '2018-02-06'
slug: using-r-to-create-google-maps
categories: 
  - R
tags:
  - maps
  - Google
  - data-viz
  - packages
  - plotKML
  
draft: TRUE

bibliography: bibliography.bib
---



<p>Google maps are a great way to share maps that users can interact with and customize for their own purposes. The <a href="https://cran.r-project.org/web/packages/RgoogleMaps/"><code>RgoogleMaps</code></a> <span class="citation">(Loecher and Ropkins 2015)</span> and <a href="https://cran.r-project.org/web/packages/ggmap/"><code>ggmap</code></a> <span class="citation">(Kahle and Wickham 2013)</span> packages are great tools to download static map queries from Google maps and plot over . There are some helpful tutorials on using <code>ggmap</code> <a href="https://rpubs.com/nickbearman/r-google-map-making">here</a> and <a href="https://www.youtube.com/watch?v=qSVwTj60di8">a video here</a>.</p>
<p>This post illustrates how I have implemented the reverse process: creating maps in R and embedding them in Google Maps using the awesome <a href="https://cran.rstudio.com/web/packages/plotKML/index.html"><code>plotKML</code></a> <span class="citation">(Hengl et al. 2015)</span> package. Specifically, I wanted to create a shareable map that overlaid Wisconsin school district boundaries onto the regular Google Maps interface to share with users who are not R users.</p>
<div id="create-polygon-frame-in-r" class="section level2">
<h2>Create Polygon Frame in R</h2>
<p>Wisconsin’s Department of Public Instruction has <a href="https://dpi.wi.gov/gis/school-district-boundaries/data">published shapefiles for district boundaries and school locations</a>. This post will use the elementary school boundary shapefile. After downloading the, we need to read the file into R using the <a href="https://cran.rstudio.com/web/packages/sf/"><code>sf</code></a> package:</p>
<pre class="r"><code>library(sp)
library(rgdal)
library(tidyverse)

#Download files to temporary directory
fname &lt;- tempfile(fileext = &quot;.zip&quot;)
dname &lt;- tempdir()
curl::curl_download(&quot;https://dpi.wi.gov/sites/default/files/imce/gis/spatialdata/tl_2013_55_unsd_elsd_harn.zip&quot;, 
                    destfile = fname, mode = &quot;wb&quot;)
unzip(fname, exdir = dname)

#Read data into R
widists &lt;- readOGR(dname, layer=&quot;tl_2013_55_unsd_elsd_harn&quot;, verbose = FALSE, stringsAsFactors = FALSE) 

plot(widists)</code></pre>
<p><img src="/post/2018-02-06-using-r-to-create-google-maps_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>This looks about right. The <code>plotKML</code> package writes geographic objects to <strong>K</strong>eyhole <strong>M</strong>arkup <strong>L</strong>anguage the format used by Google Maps, among others. The package comes with a handy vignette that I was able to use to do everything that follows.</p>
<pre class="r"><code>#Install (if needed) and load the package.
if (!require(plotKML)) {
  install.packages(&quot;plotKML&quot;)
}
library(plotKML)

#Write the district boundaries to a KML file to the working directory
kml_open(&quot;widists.kml&quot;)
kml_layer.SpatialPolygons(widists, 
                          subfolder.name = &quot;Elementary District Boundaries&quot;,
                          labels = widists@data$NAME,
                          outline = TRUE,
                          alpha = 0,
                          width = 2,
                          colour = &quot;yellow&quot;)

kml_close(&quot;widists.kml&quot;)</code></pre>
<p>Map is too large as is .. see <a href="https://philmikejones.wordpress.com/2015/09/03/dissolve-polygons-in-r/" class="uri">https://philmikejones.wordpress.com/2015/09/03/dissolve-polygons-in-r/</a></p>
</div>
<div id="references" class="section level2 unnumbered">
<h2>References</h2>
<div id="refs" class="references">
<div id="ref-HenglRoudieretal2015">
<p>Hengl, Tomislav, Pierre Roudier, Dylan Beaudette, and Edzer Pebesma. 2015. “plotKML: Scientific Visualization of Spatio-Temporal Data.” <em>Journal of Statistical Software</em> 63 (5): 1–25. <a href="http://www.jstatsoft.org/v63/i05/" class="uri">http://www.jstatsoft.org/v63/i05/</a>.</p>
</div>
<div id="ref-KahleWickham2013">
<p>Kahle, David, and Hadley Wickham. 2013. “ggmap: Spatial Visualization with ggplot2.” <em>The R Journal</em> 5 (1): 144–61. <a href="http://journal.r-project.org/archive/2013-1/kahle-wickham.pdf" class="uri">http://journal.r-project.org/archive/2013-1/kahle-wickham.pdf</a>.</p>
</div>
<div id="ref-LoecherRopkins2015">
<p>Loecher, Markus, and Karl Ropkins. 2015. “RgoogleMaps and loa: Unleashing R Graphics Power on Map Tiles.” <em>Journal of Statistical Software</em> 63 (4): 1–18. <a href="http://www.jstatsoft.org/v63/i04/" class="uri">http://www.jstatsoft.org/v63/i04/</a>.</p>
</div>
</div>
</div>
