---
title: Using R to Create Google Maps
author: ~
date: '2018-02-06'
slug: using-r-to-create-google-maps
categories: 
  - R
tags:
  - maps
  - Google
  - data-viz
  - packages
  - plotKML
  
draft: TRUE

bibliography: bibliography.bib
---

Google maps are a great way to share maps that users can interact with and 
customize for their own purposes. The 
[`RgoogleMaps`](https://cran.r-project.org/web/packages/RgoogleMaps/) [@LoecherRopkins2015]
and [`ggmap`](https://cran.r-project.org/web/packages/ggmap/) [@KahleWickham2013]
packages are great tools to download static map queries from Google maps and 
plot over . There are some helpful tutorials on using
`ggmap` [here](https://rpubs.com/nickbearman/r-google-map-making) and 
[a video here](https://www.youtube.com/watch?v=qSVwTj60di8).

This post illustrates how I have implemented the reverse process: creating 
maps in R and embedding them in Google Maps using the awesome [`plotKML`](https://cran.rstudio.com/web/packages/plotKML/index.html) [@HenglRoudieretal2015]
package. Specifically, I wanted to create a shareable map that overlaid 
Wisconsin school district boundaries onto the regular Google Maps interface 
to share with users who are not R users.

## Create Polygon Frame in R

<!-- THE FOLLOWING FILE IS TOO BIG -->
<!-- Wisconsin's Department of Public Instruction has [published shapefiles for  -->
<!-- district boundaries and school locations](https://dpi.wi.gov/gis/school-district-boundaries/data). -->
<!-- This post will use the elementary school boundary shapefile. -->

The US Census offers many different shapefiles for download 
at <https://www.census.gov/geo/maps-data/data/tiger-line.html>. After 
downloading the 2017 Wisconsin school district shapefile 
(<ftp://ftp2.census.gov/geo/tiger/TIGER2017/UNSD/tl_2017_55_unsd.zip>) and
saving it in the "mapdata" folder in the working directory, we need to 
read the file into R using the 
[`rgdal`](https://cran.rstudio.com/web/packages/rgdal/) package:

```{r, message=FALSE, warning = FALSE, cache = TRUE}
library(sp)
library(rgdal)
library(tidyverse)

#Read data into R
unzip("mapdata/tl_2017_55_unsd.zip", exdir = "mapdata/")
widists <- readOGR("mapdata/", layer="tl_2017_55_unsd", verbose = FALSE, stringsAsFactors = FALSE) 

plot(widists)
```

This looks about right. The `plotKML` package writes geographic objects to 
**K**eyhole **M**arkup **L**anguage the format used by Google Maps, among 
others. The package comes with a handy vignette that I was able to use to do 
everything that follows.

```{r, message = FALSE, warning = FALSE, cache = TRUE}
#Install (if needed) and load the package.
if (!require(plotKML)) {
  install.packages("plotKML")
}
library(plotKML)

#Write the district boundaries to a KML file to the working directory
kml_open("mapdata/widists.kml")
kml_layer.SpatialPolygons(widists, 
                          subfolder.name = "Elementary District Boundaries",
                          labels = widists@data$NAME,
                          outline = TRUE,
                          alpha = 0,
                          width = 2,
                          colour = "yellow")

kml_close("mapdata/widists.kml")
```

Map is too large as is .. see https://philmikejones.wordpress.com/2015/09/03/dissolve-polygons-in-r/


## References